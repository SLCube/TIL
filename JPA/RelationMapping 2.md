# 다양한 연관관계 매핑

## 연관관계 매핑시 고려사항 3가지
- 다중성
- 단방향, 양방향
- 연관관계의 주인

---
## 다중성
- 다대일 : @ManyToOne
- 일대다 : @OneToMany
- 일대일 : @OneToOne
- 다대다 : @ManyToMany  

## 단방향, 양방향
- 테이블
    - 외래키 하나로 양쪽 조인 가능
    - 사실상 방향이란 개념이 없음

- 객체
    - 참조용 필드가 있는 쪽으로만 참조 가능
    - 한쪽만 참조하면 단방향
    - 양쪽이 서로 참조하면 양방향

## 연관관계 주인
- 테이블은 외래키 하나로 두 테이블이 연관관계를 맺음
- 객체 양방향 관계는 사실 양방향이 아니고 단방향이 2개이다 (A -> B, B -> A)
- 참조가 2군데라서 외래키를 관리 할 곳을 지정해야됨. 외래키를 관리하는 곳이 연관관계의 주인이 된다.
---

## 다대일 N : 1 (@ManyToOne)
- 가장 많이 사용되는 연관관계
- 반대개념은 일대다(1 : N)이다.

## 일대다 1 : N (@OneToMany)
- 일대다 단방향 의 연관관계는 1이 주인이다. 그러나 DB의 외래키는 N에 있음.
- Object와 Table의 차이 때문에 연관관계 주인 반대편의 외래키를 관리해야되는 특이한 구조이다.
- @JoinColumn을 꼭 사용해야하며 그렇지않으면 중간에 테이블을 JPA가 추가한다.
- 결론은 1 : N 매핑보단 N : 1 양방향 매핑을 사용하자.

## 1 : 1 (@OneToOne)
- 1 : 1은 반대도 1 : 1이다.
- 주 테이블이나 대상 테이블 중에 외래키 선택이 가능하다.
- 1 : 1 관계이기 때문에 FK에 Unique Key제약조건 추가가 필요함.
- 단방향관계는 JPA가 지원하지 않는다
- 양방향은 지원함

- 주 테이블에 외래 키
    - 주 객체가 대상객체의 참조를 가지는 것 처럼 주 테이블에 FK를 두고 대상 테이블을 찾음
    - 장점 : 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능함
    - 단점 : 값이 없으면 외래 키에 nullable 세팅 필요

- 대상 테이블에 외래키
    - 대상테이블에 FK존재
    - DB 개발자들이 선호(나도 이게 더 좋은데)
    - 장점 : 주 테이블과 대상 테이블을 1:1 -> 1 : N관계로 변경할 때 테이블 구조 유지
    - 단점 : 프록시 기능의 한계로 지연 로딩으로 설정해도 항상 즉시 로딩됨(프록시 기능이 뭐지..?)


## M : N (@ManyToMany)
- DB는 다대다 테이블이 불가능함
- 다대다 테이블 관계를 풀어내려면 연결 테이블을 생성해야됨
- JPA에서의 다대다 매핑은 양쪽 테이블의 PK를 FK로 가지는 형식으로만 매핑함
- 그러나 실무에선 연결테이블이 단순히 연결테이블의 역할만 하지 않음
- 하다못해 등록시간 수정시간등 뭔가 기록이 남는데 다대다 매핑은 그런 컬럼을 생성할 수 없음
- 그래서 실무에선 @ManyToMany를 사용하지말자
- 다대다 매핑을 풀어내기위해서 연결테이블을 Entity로 승격시킨 후 @ManyToOne, @OneToMany를 이용해 풀어낸다


